<div class="relative bg-black text-white min-h-screen">
    <div class="flex flex-col min-h-screen">
        <header class="flex flex-col border-b border-gray-700 bg-checkout-black">
            <div class="border-b border-gray-700 bg-checkout-black">
                <div
                    class="mx-auto w-full max-w-[1248px] px-4 xl:px-0 relative flex items-center justify-center py-4 text-400 label">
                    <button type="button"
                        class="inline-flex text-center items-center justify-center w-max font-bold transition duration-200 disabled:opacity-40 rounded-full text-white hocus:text-blue-500 p-2 text-sm md:text-base absolute left-0 z-10"
                        aria-label="Browser Back"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                            viewBox="0 0 45 45" width="1em" height="100%" class="m-2 h-5 w-5">
                            <title>Back</title>
                            <path
                                d="M14.974 22.5 34.321 3.153A2.09 2.09 0 0 0 31.46.291l-20.892 20.75a2.09 2.09 0 0 0 0 2.861L31.373 44.71a2.09 2.09 0 0 0 2.862-2.862z">
                            </path>
                        </svg></button>
                    <h1>Showtimes</h1><a
                        class="inline-flex text-center items-center justify-center w-max font-bold transition duration-200 disabled:opacity-40 rounded-full text-white hocus:text-blue-500 p-2 text-sm md:text-base absolute right-0"
                        href="/"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" stroke="currentColor"
                            viewBox="0 0 45 45" width="1em" height="100%" class="m-2 h-5 w-5">
                            <title>Close</title>
                            <path stroke-width="4.0358"
                                d="M40.341 4.769a1.112 1.112 0 0 1-.022 1.587L24.071 22.604 40.32 38.85a1.112 1.112 0 0 1-1.566 1.566L22.506 24.169 6.236 40.417a1.112 1.112 0 0 1-1.565-1.566l16.27-16.247L4.67 6.356a1.125 1.125 0 0 1-.303-.767A1.13 1.13 0 0 1 5.49 4.465c.285 0 .56.11.768.304l16.248 16.269 16.268-16.27a1.117 1.117 0 0 1 1.566 0Z">
                            </path>
                        </svg></a>
                </div>
            </div>
            <form id="showtime-result-filters" aria-label="Showtime Result Filters" aria-controls="showtime-results"
                class="flex justify-center divide-x divide-gray-700"><label aria-label="Theatre Filter"
                    class="relative flex w-full max-w-[25%] flex-col items-center justify-between gap-2 p-2 text-xs transition-all duration-200 focus-within:text-blue-500 hover:text-blue-500 md:w-auto md:flex-row md:p-4 md:text-base"><select
                        class="absolute inset-0 w-full cursor-pointer appearance-none bg-transparent text-transparent [&amp;>option]:text-black"
                        name="theatre">
                        <option value="amc-village-7">AMC Village 7</option>
                        <option value="amc-19th-st-east-6">AMC 19th St. East 6</option>
                        <option value="amc-kips-bay-15">AMC Kips Bay 15</option>
                        <option value="amc-34th-street-14">AMC 34th Street 14</option>
                        <option value="amc-empire-25">AMC Empire 25</option>
                        <option value="amc-newport-centre-11">AMC Newport Centre 11</option>
                        <option value="amc-lincoln-square-13">AMC Lincoln Square 13</option>
                        <option value="amc-orpheum-7">AMC Orpheum 7</option>
                        <option value="amc-84th-street-6">AMC 84th Street 6</option>
                        <option value="amc-magic-johnson-harlem-9">AMC Magic Johnson Harlem 9</option>
                        <option value="change-location">Change Location…</option>
                    </select>
                    <div class="text-2xl" role="presentation" aria-hidden="true" tabindex="-1"><svg
                            xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 45 45" width="1em"
                            height="100%">
                            <title>Theatre</title>
                            <path
                                d="M34.65 4.808C31.277 1.436 26.499-.25 21.72.03 12.447.03 5.7 5.932 5.7 13.802c.843 11.524 5.902 22.204 14.053 30.074.562.562 1.405.843 2.249 1.124.843 0 1.405-.281 1.967-.843 5.902-5.06 14.615-18.831 14.334-30.355 0-3.373-1.405-6.745-3.653-8.994zM22.845 42.752c-.843.562-.843.562-1.968 0-5.34-4.216-13.49-17.988-13.49-28.95 0-7.026 5.902-11.804 14.334-11.804 4.216 0 8.432 1.405 11.523 4.216 1.968 1.967 3.092 4.778 3.092 7.588.562 10.962-7.589 24.171-13.491 28.95z">
                            </path>
                            <path
                                d="M22.002 7.338c-3.654 0-6.746 3.091-6.746 6.745s3.092 6.746 6.746 6.746c3.654 0 6.745-3.092 6.745-6.746 0-3.654-3.091-6.745-6.745-6.745zm0 11.804a5.038 5.038 0 0 1-5.06-5.059 5.039 5.039 0 0 1 5.06-5.059 5.039 5.039 0 0 1 5.059 5.06 5.038 5.038 0 0 1-5.06 5.058z">
                            </path>
                        </svg></div>
                    <div><span class="line-clamp-2 text-ellipsis text-center">AMC Village 7</span></div>
                    <div><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 45 45" width="1em"
                            height="100%" class="text-sm">
                            <title>Expand Options</title>
                            <path
                                d="M22.464 29.594 3.067 10.48c-.856-.57-2.283-.285-2.853.856-.285.57-.285 1.141 0 1.997l20.824 20.824c.856.856 1.997.856 2.853 0L44.715 13.62c.57-.856.285-2.282-.856-2.852-.57-.286-1.426-.286-1.997 0z">
                            </path>
                        </svg></div>
                </label>
                <label class="relative flex w-full max-w-[25%] flex-col items-center justify-between gap-2 p-2 text-xs transition-all duration-200 focus-within:text-blue-500 hover:text-blue-500 md:w-auto md:flex-row md:p-4 md:text-base">
                    <!-- Icon lịch -->
                    <div class="text-2xl cursor-pointer" role="presentation" (click)="picker.open()">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 45 45" width="1em" height="100%">
                        <title>Date</title>
                        <path d="M40.07 3.464h-7.237V.873a.873.873 0 1 0-1.746 0v2.59H13.74V.874a.873.873 0 1 0-1.746 0v2.59H4.983A3.182 3.182 0 0 0 1.8 6.675v35.088A3.182 3.182 0 0 0 4.983 45H40.07a3.182 3.182 0 0 0 3.182-3.182V6.674a3.182 3.182 0 0 0-3.182-3.21zm1.436 38.298a1.436 1.436 0 0 1-1.436 1.436H4.983a1.436 1.436 0 0 1-1.437-1.436V17.854h38.017V41.79zm0-25.654H3.518V6.674a1.436 1.436 0 0 1 1.436-1.436h7.04v3.52a.873.873 0 1 0 1.746 0V5.21h17.234v3.548a.873.873 0 1 0 1.746 0V5.21h7.238a1.436 1.436 0 0 1 1.436 1.436v9.462z"></path>
                        <path d="M18.894 34.496a2.056 2.056 0 0 1-2-1.971l-2.478.394a4.365 4.365 0 0 0 4.506 3.858 4.28 4.28 0 0 0 4.506-3.999 3.464 3.464 0 0 0-3.295-3.491l2.816-2.422v-2.169H14.5v2.225h5.407l-3.183 2.816L17.88 31.4a2.619 2.619 0 0 1 1.098-.254 1.83 1.83 0 0 1 1.943 1.633 1.859 1.859 0 0 1-2.027 1.718zm8.955-6.87v8.954h2.45V24.696H28.27l-4.027 2.366 1.098 2z"></path>
                      </svg>
                    </div>
                    
                    <!-- Ẩn input date picker nhưng vẫn có thể mở khi click icon -->
                    <div class="date-picker-container hidden">
                      <mat-form-field appearance="outline">
                        <mat-label>Chọn ngày</mat-label>
                        <input name="selectedDate" matInput [matDatepicker]="picker" [(ngModel)]="date" (dateChange)="onDateChange($event)" [matDatepickerFilter]="dateFilter">
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                      </mat-form-field>
                    </div>
                    
                    <!-- Hiển thị Ngày đã chọn -->
                    <div><span class="line-clamp-2 text-ellipsis text-center">{{ date | date:'dd/MM/yyyy' }}</span></div>
                  </label>
                  
                <label aria-label="Movie Filter"
                    class="relative flex w-full max-w-[25%] flex-col items-center justify-between gap-2 p-2 text-xs transition-all duration-200 focus-within:text-blue-500 hover:text-blue-500 md:w-auto md:flex-row md:p-4 md:text-base"><select
                        class="absolute inset-0 w-full cursor-pointer appearance-none bg-transparent text-transparent [&amp;>option]:text-black"
                        name="movie">
                        <option value="">All Movies</option>
                        @for (item of listMoive; track $index) {
                            <option value="{{item.id}}">{{item.movieName}}</option> 
                        }
                    </select>
                    <div class="text-2xl" role="presentation" aria-hidden="true" tabindex="-1"><svg
                            xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 45 45" width="1em"
                            height="100%">
                            <title>Movie</title>
                            <circle cx="19.282" cy="22.718" r="1.743"></circle>
                            <path
                                d="M19.282 17.097a5.003 5.003 0 1 0-4.975-4.863 5.003 5.003 0 0 0 4.975 4.863zm0-8.433a3.513 3.513 0 1 1-3.514 3.57 3.513 3.513 0 0 1 3.514-3.57zm5.003 24.791a5.003 5.003 0 1 0-5.003 5.003 5.003 5.003 0 0 0 5.003-5.003zm-8.432 0a3.513 3.513 0 1 1 3.513 3.514 3.513 3.513 0 0 1-3.598-3.514zm14.053-5.621a5.003 5.003 0 1 0-5.003-5.116 5.003 5.003 0 0 0 5.003 5.116zm0-8.433a3.513 3.513 0 1 1-3.513 3.317 3.513 3.513 0 0 1 3.513-3.373zm-21.22-1.545a5.003 5.003 0 1 0 5.002 4.862 5.003 5.003 0 0 0-5.003-4.862zm0 8.432a3.513 3.513 0 1 1 3.513-3.57 3.513 3.513 0 0 1-3.514 3.654z">
                            </path>
                            <path
                                d="M44.27 40.51H26.645A19.225 19.225 0 1 0 19.282 42h24.96a.745.745 0 0 0 .027-1.49zM1.517 22.718A17.792 17.792 0 1 1 19.31 40.51 17.82 17.82 0 0 1 1.518 22.718z">
                            </path>
                            <circle cx="16.808" cy="20.413" r="0.646"></circle>
                            <circle cx="21.783" cy="25.388" r="0.646"></circle>
                            <circle cx="16.836" cy="25.332" r="0.646"></circle>
                            <circle cx="21.755" cy="20.385" r="0.646"></circle>
                            <path
                                d="M19.703 19.907a.646.646 0 1 0-.899-.899.646.646 0 0 0 .9.9zM18.635 26.4a.646.646 0 1 0 .197-.45.646.646 0 0 0-.197.45zm-3.26-3.963a.646.646 0 1 0 .45-.197.646.646 0 0 0-.45.197zm7.898.871a.646.646 0 0 0 0-.899.646.646 0 1 0 0 .9z">
                            </path>
                        </svg></div>
                    <div><span class="line-clamp-2 text-ellipsis text-center">All Movies</span></div>
                    <div><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 45 45" width="1em"
                            height="100%" class="text-sm">
                            <title>Expand Options</title>
                            <path
                                d="M22.464 29.594 3.067 10.48c-.856-.57-2.283-.285-2.853.856-.285.57-.285 1.141 0 1.997l20.824 20.824c.856.856 1.997.856 2.853 0L44.715 13.62c.57-.856.285-2.282-.856-2.852-.57-.286-1.426-.286-1.997 0z">
                            </path>
                        </svg></div>
                </label>
                <label aria-label="Premium Offering Filter"
                    class="relative flex w-full max-w-[25%] flex-col items-center justify-between gap-2 p-2 text-xs transition-all duration-200 focus-within:text-blue-500 hover:text-blue-500 md:w-auto md:flex-row md:p-4 md:text-base">
                    <select
                        class="absolute inset-0 w-full cursor-pointer appearance-none bg-transparent text-transparent [&amp;>option]:text-black"
                        name="premiumOffering">
                        <option value="">Premium Offerings</option>
                        <option value="reclinerseating">AMC Signature Recliners</option>
                        <option value="reservedseating">Reserved Seating</option>
                        <option value="opencaption">Open Caption (On-screen Subtitles)</option>
                        <option value="reald3d">RealD 3D</option>
                        <option value="mandarinenglishsubtitle">Mandarin Spoken with English Subtitles</option>
                        <option value="laseratamc">Laser at AMC</option>
                        <option value="amcartisanfilms">AMC Artisan Films</option>
                        <option value="closedcaption">Closed Caption</option>
                    </select>
                    <div class="text-2xl" role="presentation" aria-hidden="true" tabindex="-1"><svg
                            xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 45 45" width="1em"
                            height="100%">
                            <title>Premium Offerings</title>
                            <path
                                d="M23.495 29.21V1.57a.995.995 0 1 0-1.99 0v27.64a5.528 5.528 0 0 0 0 11.057v3.51a.995.995 0 0 0 1.99 0V40.24a5.528 5.528 0 0 0 0-11.029zm-.995 9.122a3.593 3.593 0 1 1 3.593-3.593 3.593 3.593 0 0 1-3.593 3.593zm16.972-33.28V1.514a.995.995 0 1 0-1.99 0v3.538a5.528 5.528 0 0 0 0 11.057v27.64a.995.995 0 0 0 1.99 0V16.11a5.528 5.528 0 0 0 0-11.057zm-.995 9.094a3.593 3.593 0 1 1 3.593-3.593 3.593 3.593 0 0 1-3.593 3.593zM7.518 17.822V1.514a.995.995 0 1 0-1.99 0v16.308a5.528 5.528 0 0 0 0 11.057v14.926a.995.995 0 0 0 1.99 0V28.879a5.528 5.528 0 0 0 0-11.057zm-.995 9.094a3.593 3.593 0 1 1 3.594-3.593 3.593 3.593 0 0 1-3.594 3.593z">
                            </path>
                        </svg></div>
                    <div><span class="line-clamp-2 text-ellipsis text-center">Premium Offerings</span></div>
                    <div><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 45 45" width="1em"
                            height="100%" class="text-sm">
                            <title>Expand Options</title>
                            <path
                                d="M22.464 29.594 3.067 10.48c-.856-.57-2.283-.285-2.853.856-.285.57-.285 1.141 0 1.997l20.824 20.824c.856.856 1.997.856 2.853 0L44.715 13.62c.57-.856.285-2.282-.856-2.852-.57-.286-1.426-.286-1.997 0z">
                            </path>
                        </svg></div>
                </label>
            </form>
        </header>
        <main class="flex-1 overflow-x-hidden">
            <div class="container mx-auto px-4 xl:px-0 py-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Cột bên trái cho danh sách phim (2/3 width) -->
                    <div class="lg:col-span-2">
                        <div class="divide-y divide-gray-700 space-y-8">
                            @for (movieName of groupedData | keyvalue; track $index) {
                                <section class="pt-8 first:pt-0">
                                    <!-- Movie header -->
                                    <div class="flex items-start gap-6 mb-6">
                                        <img [src]="movieName.value.thumbnail" 
                                             alt="Movie thumbnail" 
                                             class="w-24 h-24 object-cover rounded-lg"
                                             loading="lazy">
                                        <div>
                                            <h2 class="text-2xl font-bold mb-2">{{movieName.key}}</h2>
                                            <p class="text-gray-400">{{ movieName.value.duration | durationFormat }}</p>
                                        </div>
                                    </div>

                                    <!-- Theaters list -->
                                    @for (theaters of movieName.value.theaters | keyvalue; track $index) {
                                        <div class="mb-8 last:mb-0">
                                            <h3 class="text-xl font-semibold mb-4">{{theaters.key}}</h3>
                                            <p class="text-gray-400 mb-4">{{theaters.value.address}}</p>
                                            
                                            <!-- Showtimes grid -->
                                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                                                @for (showtime of theaters.value.showtimes | keyvalue; track $index) {
                                                    <div class="flex flex-col items-center">
                                                        <button type="button"
                                                            [routerLink]="['/booking', showtime.value.id]"
                                                            [class]="showtime.value.remainingSeats > 0 ? 
                                                                'w-full py-3 px-4 rounded-full border-2 border-white hover:border-blue-500 hover:text-blue-500 transition-all font-medium' :
                                                                'w-full py-3 px-4 rounded-full border-2 border-gray-600 text-gray-600 line-through cursor-not-allowed'"
                                                            [disabled]="showtime.value.remainingSeats === 0">
                                                            {{showtime.value.startTime}}
                                                        </button>
                                                        <span [class]="'mt-2 text-sm ' + 
                                                            (showtime.value.remainingSeats > 20 ? 'text-green-500' :
                                                            showtime.value.remainingSeats > 0 ? 'text-yellow-500' : 'text-red-500')">
                                                            {{showtime.value.remainingSeats === 0 ? 'Hết vé' : 
                                                            showtime.value.remainingSeats + ' ghế trống'}}
                                                        </span>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    }
                                </section>
                            }
                        </div>
                    </div>

                    <!-- Cột bên phải cho trailer (1/3 width) -->
                    <div class="lg:col-span-1">
                        <div class="sticky top-4">
                            @for (movieName of groupedData | keyvalue; track $index) {
                                @if ($first) {
                                    <!-- Trailer -->
                                    <div class="aspect-video rounded-lg overflow-hidden bg-gray-900 mb-6">
                                        <iframe [src]="movieName.value.trailer | safe"
                                                class="w-full h-full"
                                                frameborder="0"
                                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                                allowfullscreen>
                                        </iframe>
                                    </div>

                                    <!-- Movie info -->
                                    <div class="p-4 bg-gray-900 rounded-lg">
                                        <h3 class="text-xl font-bold mb-2">{{movieName.key}}</h3>
                                        <p class="text-gray-400 mb-4">{{ movieName.value.duration | durationFormat }}</p>
                                        <a [routerLink]="['/movie-detail', movieName.key]"
                                           class="inline-flex items-center text-blue-500 hover:text-blue-400">
                                            Chi tiết phim
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                                            </svg>
                                        </a>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div role="region" aria-label="Notifications (F8)" tabindex="-1" style="pointer-events:none">
        <ol tabindex="-1" class="fixed bottom-0 right-0 grid w-full max-w-full gap-4 p-4 md:w-96"></ol>
    </div>
    <dialog
        class="flex items-center justify-center empty:hidden w-[100vw] h-[100dvh] bg-transparent max-w-[100vw] max-h-[100dvh]">
    </dialog>
